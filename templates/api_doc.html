{% extends 'base.html' %}

{% block head %}
	{{ super() }}
	<link rel=stylesheet href=/css/api_doc.css>
{% endblock %}

{% block title %} Emoji Connoisseur API docs {% endblock %}

{% block content %}
	{{ super() }}
	<h2>Base URL</h2>
	The base URL for all endpoints shall be one of:
	<ul>{% for url in urls %}
		<li><span class="api-url">{{ url }}{{ api_prefix }}</span></li>
	{% endfor %}</ul>

	<h2>General Information</h2>
	<p>
		All responses are in JSON form.
	</p>

	{% macro linked_header(title, slug, level=3) %}
	<h{{ level }} id="{{ slug }}">
		{{ title }}
		<a href="#{{ slug }}" class="header-link">
			<img src=/img/link.png>
		</a>
	</h3>
	{% endmacro %}

	{{ linked_header('Authorization', 'authorization') }}
	<p>
		To get an API token, run <code>{{ prefix }}api token</code>
		or <code>{{ prefix }}api token regenerate</code>.
		Your token will be sent to you via DMs. Set the "Authorization" header in all authenticated
		requests to that token. All authenticated actions will then take place as your Discord account.
	</p>
	<h2>Objects and Data Types</h2>
	<p>
		A <code>?</code> following the name of a field indicates that it may be null.
	</p>

	{{ linked_header('Emoji Connoisseur Date Time', 'ec-datetime') }}
	<p>
		All times are recorded in seconds (without leap seconds) since the Emoji Connoisseur Epoch, which is the first second of 2018-02-15, UTC.
		In Unix time, that's 1518652800.
	</p>

	{{ linked_header('Emote', 'emote-object') }}
	<div class=table-container><table class="fields">
		{% set fields_header %}
		<thead><tr>
			<th>Field name
			<th>Type
			<th>Description
		</tr></thead>
		{% endset %}
		{{ fields_header }}
		<tr> <td>name <td>String <td>
		<tr> <td>id <td>String <td>represents a Discord snowflake
		<tr> <td>author <td>String <td>represents the author's Discord ID
		<tr> <td>animated <td>Boolean</td> <td>
		<tr>
			<td>created
			<td><a href="#ec-datetime">Emoji Connoisseur Date Time</a>
			<td>
		<tr>
			<td>modified?
			<td><a href="#ec-datetime">Emoji Connoisseur Date Time</a>
			<td>
		<tr> <td>preserve <td>Boolean <td>whether to prevent this emote from being removed if it goes unused
		<tr> <td>description? <td>String <td>
	</table></div>

	{{ linked_header('Emote with Usage', 'emote-with-usage-object') }}
	Fields: everything in <a href="#emote-object">Emote</a>, plus:
	<div class=table-container><table class="fields">
		{{ fields_header }}
		<tr> <td>usage <td>Integer <td>how many times the emote was used in the past 4 weeks
	</table></div>

	<h2>Endpoints</h2>

	{% macro endpoint(title, slug, method, url, authed=False) %}
	<h3 class=http-req-title id="{{ slug }}">
		{{ title }}
		<a href="#{{ slug }}" class=header-link><img src=/img/link.png></a>
	</h3>
	<span class=http-req><span class=http-method>{{ method }}</span> {{ url }}</span>
	<p>
		{% if authed %}
			Requires authorization.<br>
		{% endif %}
		{{ caller() }}
	</p>
	{% endmacro %}

	{% call endpoint('Test token', 'test-token', 'GET', '/login', authed=True) %}
		<div class=table-container><table class="fields">
			{{ fields_header }}
			<tr> <td>user_id <td>String <td>The user ID associated with your token.
		</table></div>
	{% endcall %}

	{% call endpoint('Get Emote', 'get-emote', 'GET', '/emote/{emote.name}') %}
		One <a href="#emote-with-usage-object">emote with usage object</a>, or 404 if not found.
	{% endcall %}

	{% call endpoint('Create Emote', 'create-emote', 'POST', '/emote/{name}/{url}', authed=True) %}
		Creates a new emote with name <code>{name}</code> and url <code>{url}</code>.<br>
		Returns the <a href="#emote-object">emote object</a> that was created on success.
	{% endcall %}

	{% call endpoint('Edit Emote', 'edit-emote', 'PATCH', '/emote/{emote.name}', authed=True) %}
		Requires JSON data:
		<div class=table-container><table class=fields>
			{{ fields_header }}
			<tr> <td> name <td> string <td> new name for the emote
			<tr> <td> description? <td> string <td> new description for the emote, or null to delete the description
		</table></div>
	{% endcall %}

	{% call endpoint('Delete Emote', 'delete-emote', 'DELETE', '/emote/{emote.name}', authed=True) %}
		One <a href="#emote-object">emote object</a> that was deleted on success.
	{% endcall %}

	{% call endpoint('List Emotes', 'list-emotes', 'GET', '/emotes') %}
		List of <a href="#emote-object">emote objects</a>, or 404 if no emotes have been created yet.
	{% endcall %}

	{% call endpoint('Search Emotes', 'search-emotes', 'GET', '/search/{query}') %}
		List of <a href="#emote-object">emote objects</a> whose name case-insensitively includes <code>{query}</code>.
	{% endcall %}

	{% call endpoint('List Popular Emotes', 'list-popular-emotes', 'GET', '/popular') %}
		List of all <a href="#emote-with-usage-object">emotes with usage</a>, sorted by popularity, or 404
		if no emotes have been created yet.
	{% endcall %}

{% endblock %}
